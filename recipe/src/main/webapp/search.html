<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>냉장고를 가져와</title>
<link rel="stylesheet"
	href="bower_components/bootstrap/dist/css/bootstrap.css">
<link rel="stylesheet" media="all" href="css/search.css" />
<link rel="stylesheet" href="css/font.css">
<link href="css/sweetalert.css" rel="stylesheet">

<script src="js/sweetalert.min.js"></script>
<script src="bower_components/jquery/dist/jquery.min.js"></script>
<script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="bower_components/handlebars/handlebars.min.js"></script>
<script src="js/moment.js"></script>
<script src="js/scripts.js"></script>
<script src="js/auth.js"></script>
<script src="js/loginCheck.js"></script>
<script src="js/likes.js"></script>
</head>

<body>
	<nav class="navbar navbar-default">
		<div class="container-fluid">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed"
					data-toggle="collapse" data-target="#defaultNavbar1">
					<span class="sr-only">Toggle navigation</span> <span
						class="icon-bar"></span> <span class="icon-bar"></span> <span
						class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="index.html"><img id="titleimg"
					src="img/title.PNG" /></a>
			</div>
			<div class="collapse navbar-collapse" id="defaultNavbar1">
				     <form class="navbar-form navbar-left" role="search" onsubmit="return false">
               <div class="form-group">
                  <input type="text" value="" class="form-control" id="searchvalue"
                     placeholder="예) 김치 볶음밥" onkeypress="if( event.keyCode==13 ){fncSubmit();}">
               </div>
               <a onclick='javascript:fncSubmit();' class="btn btn-default">검색</a>
            </form>
				<div class="collapse navbar-collapse"
					id="bs-example-navbar-collapse-1">
					<ul class="nav navbar-nav navbar-right">
						<li><a id="login" class="launch-modal" href="#"
							data-modal-id="modal-register1">로그인</a></li>
						<li><a id="signup" class="launch-modal" href="#"
							data-modal-id="modal-register2">회원가입</a></li>
						<li><a id="logout">로그아웃</a></li>
						<li><a id="mypage" href="member/myPage.html">마이페이지</a></li>
					</ul>

					<!-- 로그인 -->
					<!-- <form action="auth/login.do" method="post"> -->
					<div class="modal fade" id="modal-register1" tabindex="-1"
						role="dialog" aria-labelledby="modal-register-label"
						aria-hidden="true">
						<div class="modal-dialog">
							<div class="modal-content">
								<div class="modal-header">
									<button type="button" class="close" data-dismiss="modal">
										<span aria-hidden="true">&times;</span><span class="sr-only">Close</span>
									</button>
									<h3 class="modal-title" id="modal-register-label">로그인</h3>
								</div>
								<div class="modal-body">
									<div class="form-group">
										<label class="sr-only">Id</label> <input type="text"
											placeholder="ID" class="form-id form-control" id="mem_id"
											name="id">
									</div>
									<div class="form-group">
										<label class="sr-only">Password</label> <input type="password"
											placeholder="Password" class="form-password form-control"
											id="mem_pwd" name="password">
									</div>
									<button class="log_btn btn">로그인</button>
								</div>
							</div>
						</div>
					</div>
					<!-- </form> -->

					<!-- 회원가입 -->
					<form action="auth/add_search.do" method="post" id="test_form">
						<div class="modal fade" id="modal-register2" tabindex="-1"
							role="dialog" aria-labelledby="modal-register-label"
							aria-hidden="true">
							<div class="modal-dialog">
								<div class="modal-content">
									<div class="modal-header">
										<button type="button" class="close" data-dismiss="modal">
											<span aria-hidden="true">&times;</span> <span class="sr-only">Close</span>
										</button>
										<h3 class="modal-title" id="modal-register-label">회원가입</h3>
									</div>
									<div class="modal-body">
										<div class="form-group">
											<label class="sr-only">Id</label> <input type="text"
												placeholder="ID" class="form-id form-control" name="id" id="jid">
										</div>
										<div class="form-group">
											<label class="sr-only">Email</label> <input type="text"
												placeholder="Email(aaa@bbb.com)" class="form-email form-control"
												name="email" id="jemail">
										</div>
										<div class="form-group">
											<label class="sr-only">Password</label> <input
												type="password" placeholder="Password(6~15글자 영문+숫자조합)"
												class="form-password form-control" name="password" id="jPassword">
										</div>
										<button class="btn">회원가입</button>
									</div>
								</div>
							</div>
						</div>
					</form>
				</div>
			</div>
		</div>
	</nav>
  <script src="js/joinCheck.js"></script>

	<script>
  var searchValue;
  $('input').keyup(function() {
    searchValue = encodeURIComponent($(this).val());
  });
  function fncSubmit() {
    location.href = 'search.html?value=' + searchValue;
  }
  </script>

	
	<div class="container">
		<section class="sec_main_recipe">
		<nav id="menubar" class="navbar">
    <div>
      <ul class="nav navbar-nav" style="margin-left: 42px;">
        <li class="active"><a href="#spy1">닉네임으로 검색된 결과 ▼ |</a></li>
        <li><a href="#spy2">제목으로 검색된 결과 ▼ |</a></li>
        <li><a href="#spy3">음식태그로 검색된 결과 ▼ </a></li>
      </ul>
    </div>
  </nav>
			<div>
				<div>
					<p class="search_tag"></p>
				</div>
				<hr>
				<dl class="inner" id="spy1">
					<dt>
						닉네임으로 검색된 결과<br> <br>
					</dt>
					<dd></dd>
					<dd>
						<ol class="lst_recipe" id="list1"></ol>
					</dd>
				</dl>
				<hr>
				<dl class="inner" id="spy2">
					<dt>
						제목으로 검색된 결과<br> <br>
					</dt>
					<dd></dd>
					<dd>
						<ol class="lst_recipe" id="list2"></ol>
					</dd>
				</dl>
				<hr>
				<dl class="inner" id="spy3">
					<dt>
						음식태그로 검색된 결과<br> <br>
					</dt>
					<dd></dd>
					<dd>
						<ol class="lst_recipe" id="list3"></ol>
					</dd>
				</dl>
			</div>
			<nav class="navbar navbar-right navbar-fixed-bottom">
				<div class="container-fluid">
					<div>
						<ul class="nav navbar-nav" style="float: right; margin-right: 200px;">
							<li class="active" ><a href="#">▲TOP</a></li>
						</ul>
					</div>
				</div>
			</nav>
			<hr>
		</section>
		<footer>
			<div class="text-center col-xs-6 col-xs-offset-3">
				<p>
					Copyright &copy; 2016 &middot; All Rights Reserved &middot; <a
						href="http://127.0.0.1:8080/index.html">냉장고를 가져와</a>
				</p>
			</div>
		</footer>
	</div>

	<script>
  var Request = function() {
    this.getParameter = function(name) {
      var rtnval = '';
      var nowAddress = location.href;
      var parameters = (nowAddress.slice(nowAddress.indexOf('?')+1,nowAddress.length)).split('&');
      for(var i = 0 ; i < parameters.length ; i++) {
        var varName = parameters[i].split('=')[0];
        if(varName.toUpperCase() == name.toUpperCase()) {
          rtnval = parameters[i].split('=')[1];
          console.log('===>', rtnval);
          break;
        }
      }
      return rtnval;
    }
  }
  var request = new Request();
  </script>

	<script id="card" type="text/x-handlebars-template">
  {{#each list}}
  <li class="cardlist" id="a{{@index}}">
    <input id="bno{{@index}}" type="hidden" value="{{bno}}"/>
    
    <div id="f1_container">

      <div id="f1_card">
        <div class="card front face" id="card{{@index}}">
          <div class="thmb"> <img src="webapp/{{m_photo}}"/> </div> 
          <span class="author"> 
            <img src="webapp/{{photo}}"/>
            <strong>{{nick}}</strong> 
          </span>
          <div class="title"><p>{{title}}</p></div>
        </div>

      <div class="back center">
        <script>
          var level = {{level}};
          var levelStar;
          if(level <= 1) levelStar = "img/1star.png";
          else if(level <= 2) levelStar = "img/2star.png";
          else if(level <= 3) levelStar = "img/3star.png";
          else if(level <= 4) levelStar = "img/4star.png";
          else if(level <= 5) levelStar = "img/5star.png";
          $("#star{{@index}}").attr("src", levelStar);
        <{{!}}/script>
      
        <div class="level">난이도 : <img id="star{{@index}}" src="" style="width:40%; margin-top:-2px;"> </div>
        <div class="intro2"> {{{cont}}} </div>
        <div class="ingre" id="ingre{{@index}}">{{tname}}</div>
        <div class="date">{{w_dt}}</div>
        <div class="option2">
          <div class="col-xs-6 col-xs-6"></div>
          <div class="col-xs-6 col-xs-6"><a href="urlPage.html?bno={{bno}}">자세히 보기</a></div>
        </div>
      </div>
    </div>

    <div class="option">
      <div class="time"><button>{{time}}분</button></div>
      <div class="like"><button id="like_{{bno}}" type="submit" data-state="before" onclick="c_like(this);" data-bno='{{bno}}' data-likes="{{likes}}">{{likes}}명</button></div>
      <div class="share">
        <button type="button" class="share_btn btn-default" title="아래 링크를 복사하세요." id="abc"
          data-container="body" data-toggle="popover" data-placement="bottom" 
          data-content="http://localhost:8080/recipe/urlPage.html?bno={{bno}}">공유하기</button>
      </div>
    </div>
  </li>
  {{/each}}
  </script>

  <script>
    $(document).on("click", "#abc", function() {
      $('[data-toggle="popover"]').popover({
        container : "body"
      });
    });
  </script>

	<script>
  var value = request.getParameter('value');
  console.log("received(encoded) value: " + value);
  value = decodeURIComponent(value);
  console.log("decoded value: " + value);
  
  $(document).ready(function() {
    $.post("./ajax/recipe/searchRecipeByNick.do", {
      nick : value
    }, function(result) {
    	for (var i = 0; i < (result.list).length; i++) {
            result.list[i].w_dt = moment(result.list[i].w_dt,
                'MM/DD/YYYY').format().substr(0, 10)
          }
    	var cardno = result.list;
      var template = Handlebars.compile($('#card').html());
      if((result.list).length == 0) {
          $("#list1").append("　　　　검색 결과가 없습니다.");
        } else {
          $("#list1").append(template(result));
        }
      init(cardno);
    }, "json");
  });
  
  $(document).ready(function() {    
    $.post("./ajax/recipe/searchRecipeByTitle.do", {
      title : value
    }, function(result) {
    	for (var i = 0; i < (result.list).length; i++) {
            result.list[i].w_dt = moment(result.list[i].w_dt,
                'MM/DD/YYYY').format().substr(0, 10)
          }
    	var cardno = result.list;
      var template = Handlebars.compile($('#card').html());
      if((result.list).length == 0) {
        $("#list2").append("　　　　검색 결과가 없습니다.");
      } else {
        $("#list2").append(template(result));
      }
      init(cardno);
    }, "json");
  });
  
  $(document).ready(function() {    
    $.post("./ajax/recipe/searchRecipeByTag.do", {
      tag : value
    }, function(result) {
    	for (var i = 0; i < (result.list).length; i++) {
            result.list[i].w_dt = moment(result.list[i].w_dt,
                'MM/DD/YYYY').format().substr(0, 10)
          }
    	var cardno = result.list;
      var template = Handlebars.compile($('#card').html());
      if((result.list).length == 0) {
          $("#list3").append("　　　　검색 결과가 없습니다.");
        } else {
          $("#list3").append(template(result));
        }
      init(cardno);
    }, "json");
  });
  </script>

	<script>
  var c = false;
  
  $(function() {
    $(".category1").css("color", "black").css("font-weight", "600");
  });
  
  $(".category1").click(function() {
    if (c == true) {
      $(".category1").css("color","black").css("font-weight", "600");
      $(".category2").css("color","gray").css("font-weight", "normal");
      c = false;
    };
  });
  
  $(".category2").click(function() {
    if (c == false) {
      $(".category2").css("color","black").css("font-weight", "600");
      $(".category1").css("color","gray").css("font-weight", "normal");
      c = true;
    };
  });
  </script>

	<script>
function init(cardno) {
    for (var i = 0; i < cardno.length; i++) {
      $
          .ajax({
            method : "POST",
            url : "./ajax/likes/islike.do?bno=" + cardno[i].bno,
            dataType : "json",
            async : false,
            success : function(result) {
              if (result) {
                //console.log("#like_"+cardno[i].bno);

                $("#like_" + cardno[i].bno).attr(
                    "data-state", "after");
                $("#like_" + cardno[i].bno)
                    .css("background",
                        "url(./img/icon_heart_full.png) 7px center no-repeat");
              } else {
              }
            }
          })
    }
  }
</script>
	<script>
// 로그인 실패시 뜨는 팝업
$(".log_btn").click(function() {
  $.ajax("auth/login.do?", {
    method : "POST",
    dataType : "JSON",
    data : {
      id : $("#mem_id").val(),
      password : $("#mem_pwd").val()
    },
    success : function(result) {
      if (result.status == "success") {
        location.href = "search.html?value=" + value; 
      } else if (result.status == "failure") {
        swal({confirmButtonColor: "#DD6B55",
          title: '로그인 실패',
          text: "아이디 또는 비밀번호를 다시 확인해주세요.",
          type: 'warning'})
      }
    }
  });
})
  
// 로그아웃 눌렀을 때, 현재 urlPage 유지하기
  $("#logout").click(function() {
    $.ajax("auth/logout_search.do?", {
      method : "POST",
      dataType : "JSON",
      data : {
      }, success : $(function() {
          location.href = "search.html?value=" + value; 
      })
    });
})
</script>
</body>
</html>