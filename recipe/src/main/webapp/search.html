<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>냉장고를 가져와</title>
<link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.css">
<link rel="stylesheet" media="all" href="css/search.css" />
<link rel="stylesheet" href="css/font.css">

<script src="bower_components/jquery/dist/jquery.min.js"></script>
<script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="bower_components/handlebars/handlebars.min.js"></script>
</head>

<body>  
  <nav class="navbar navbar-default">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#defaultNavbar1"> 
          <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html"><img id="titleimg" src="img/title.PNG"/></a>
      </div>
      <div class="collapse navbar-collapse" id="defaultNavbar1">
        <form class="navbar-form navbar-left" role="search">
          <div class="form-group"><input type="text" value="" class="form-control" id="searchvalue" placeholder="예) 김치 볶음밥"></div>
          <a onclick='javascript:fncSubmit();' class="btn btn-default">검색</a>          
        </form>
        <ul class="nav navbar-nav navbar-right">
          <li><a href="#">로그아웃</a></li>
          <li><a href="myPage.html">마이페이지</a></li>
        </ul>
      </div>
    </div>
  </nav>
  
  <script>
  var searchValue;        
  $('input').keyup(function() {
    searchValue = encodeURIComponent($(this).val());
  });        
  function fncSubmit() {
    console.log("encoded searchValue: " + searchValue);
//    searchValue = decodeURI(searchValue);
//    console.log("decoded searchValue: " + searchValue);
    location.href = 'search.html?value=' + searchValue;
  }
  </script>
        
  <div class="container">
    <section class="sec_main_recipe">
      <div>
        <div>
          <p class="search_tag"> 
          </p>
        </div>
        <hr>
        <dl class="inner">
          <dt>닉네임으로 검색된 결과<br><br></dt>
          <dd></dd>
          <dd>
            <ol class="lst_recipe" id="list1"></ol>
          </dd>
        </dl>
        <hr>
        <dl class="inner">
          <dt>제목으로 검색된 결과<br><br></dt>
          <dd></dd>
          <dd>
            <ol class="lst_recipe" id="list2"></ol>
          </dd>
        </dl>
        <hr>
        <dl class="inner">
          <dt>음식태그로 검색된 결과<br><br></dt>
          <dd></dd>
          <dd>
            <ol class="lst_recipe" id="list3"></ol>
          </dd>
        </dl>
      </div>
      <hr>
    </section>
  <footer>
    <div class="text-center col-xs-6 col-xs-offset-3">
      <p>
        Copyright &copy; 2016 &middot; All Rights Reserved &middot; <a
          href="http://127.0.0.1:8080/index.html">냉장고를 가져와</a>
      </p>
    </div>
  </footer>
  </div>
  
  <script>
  var Request = function() {
    this.getParameter = function(name) {
      var rtnval = '';
      var nowAddress = location.href;
      var parameters = (nowAddress.slice(nowAddress.indexOf('?')+1,nowAddress.length)).split('&');
      for(var i = 0 ; i < parameters.length ; i++) {
        var varName = parameters[i].split('=')[0];
        if(varName.toUpperCase() == name.toUpperCase()) {
          rtnval = parameters[i].split('=')[1];
          console.log('===>', rtnval);
          break;
        }
      }
      return rtnval;
    }
  }
  var request = new Request();
  </script>
  
  <script id="card" type="text/x-handlebars-template">
  {{#each list}}
  <li class="cardlist" id="a{{@index}}">
    <input id="bno{{@index}}" type="hidden" value="19"/>
    <div id="f1_container">
      <div id="f1_card">
        <div class="card front face" id="card{{@index}}">
          <div class="thmb"> <img src="webapp/{{m_photo}}"/> </div> 
          <span class="author"> 
            <img src="webapp/{{photo}}"/>
            <strong>{{nick}}</strong> 
          </span>
          <div class="title"><p>{{title}}</p></div>
        </div>

      <div class="back face center">
        <script>
          var level = {{level}};
          var levelStar;
          if(level <= 1) levelStar = "img/1star.png";
          else if(level <= 2) levelStar = "img/2star.png";
          else if(level <= 3) levelStar = "img/3star.png";
          else if(level <= 4) levelStar = "img/4star.png";
          else if(level <= 5) levelStar = "img/5star.png";
          $("#star{{@index}}").attr("src", levelStar);
        <{{!}}/script>
      
        <div class="level">난이도 : <img id="star{{@index}}" src="" style="width:40%; margin-top:-2px;"> </div>
        <div class="intro2"> {{cont}} </div>
        <div class="ingre" id="ingre{{@index}}">{{tname}}</div>
        <div class="date">{{w_dt}}</div>
        <div class="option2">
          <div class="blog"><a href="urlPage.html">자세히 보기</a></div>
        </div>
      </div>
    </div>
        <div class="option">
          <div class="time"><button>{{time}}분</button></div>
          <div class="like"><button id="like_{{bno}}" type="submit" data-state="before" onclick="c_like(this);" data-bno='{{bno}}' data-likes="{{likes}}">{{likes}}명</button></div>
          <div class="share"><button>공유하기</button></div>
        </div>
  </li>
  {{/each}}
  </script>
  
  <script>
  var value = request.getParameter('value');
  console.log("received(encoded) value: " + value);
  value = decodeURIComponent(value);
  console.log("decoded value: " + value);
  
  $(document).ready(function() {
    $.post("./ajax/recipe/searchRecipeByNick.do", {
      nick : value
    }, function(result) {
    	var cardno = result.list;
      var template = Handlebars.compile($('#card').html());
      $("#list1").append(template(result));
      init(cardno);
    }, "json");
  });
  
  $(document).ready(function() {    
    $.post("./ajax/recipe/searchRecipeByTitle.do", {
      title : value
    }, function(result) {
    	var cardno = result.list;
      var template = Handlebars.compile($('#card').html());
      $("#list2").append(template(result));
      init(cardno);
    }, "json");
  });
  
  $(document).ready(function() {    
    $.post("./ajax/recipe/searchRecipeByTag.do", {
      tag : value
    }, function(result) {
    	var cardno = result.list;
      var template = Handlebars.compile($('#card').html());
      $("#list3").append(template(result));
      init(cardno);
    }, "json");
  });
  </script>
  
  <script>
  var c = false;
  
  $(function() {
    $(".category1").css("color", "black").css("font-weight", "600");
  });
  
  $(".category1").click(function() {
    if (c == true) {
      $(".category1").css("color","black").css("font-weight", "600");
      $(".category2").css("color","gray").css("font-weight", "normal");
      c = false;
    };
  });
  
  $(".category2").click(function() {
    if (c == false) {
      $(".category2").css("color","black").css("font-weight", "600");
      $(".category1").css("color","gray").css("font-weight", "normal");
      c = true;
    };
  });
  </script>
  
<script>
function init(cardno) {
    for (var i = 0; i < cardno.length; i++) {
      $
          .ajax({
            method : "POST",
            url : "./ajax/likes/islike.do?bno=" + cardno[i].bno,
            dataType : "json",
            async : false,
            success : function(result) {
              if (result) {
                //console.log("#like_"+cardno[i].bno);

                $("#like_" + cardno[i].bno).attr(
                    "data-state", "after");
                $("#like_" + cardno[i].bno)
                    .css("background",
                        "url(./img/icon_heart_full.png) 7px center no-repeat");
              } else {
              }
            }
          })
    }
  }
</script>
<script src="js/likes.js"></script>
</body>
</html>