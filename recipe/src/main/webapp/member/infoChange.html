<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>냉장고를 가져와</title>
  <link rel="stylesheet" href="../bower_components/bootstrap/dist/css/bootstrap.css">
  <link rel="stylesheet" href="../css/sweetalert.css" >
  <link rel="stylesheet" href="../css/jquery-ui.css">
  <link rel="stylesheet" href="../css/infoChange.css">
  <link rel="stylesheet" href="../css/myPageInnerForm.css">
  <link rel="stylesheet" href="../css/font.css">
  <link rel="stylesheet" href="../css/tabmenu.css">
  <script src="../js/moment.js"></script>
  <script src="../bower_components/jquery/dist/jquery.min.js"></script>
  <script src="../js/sweetalert.min.js"></script>
  <script src="../js/jquery-ui.js"></script>
  <script src="http://code.jquery.com/jquery-latest.min.js"></script>
  <script src="../bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
  <script src="../bower_components/handlebars/handlebars.min.js"></script>
  <script src="../js/tabmenu.js"></script>
  <script type="text/javascript" src="../js/common.js"></script>
</head>

<body>
  <nav class="navbar navbar-default">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#defaultNavbar1"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button>
        <a class="navbar-brand" href="../index.html"><img id="titleimg" src="../img/title.PNG"/></a></div>
      <div class="collapse navbar-collapse" id="defaultNavbar1">
        <form class="navbar-form navbar-left" role="search" onsubmit="return false">
           <div class="form-group">
              <input type="text" value="" class="form-control" id="searchvalue"
                 placeholder="예) 김치 볶음밥" onkeypress="if( event.keyCode==13 ){fncSubmit();}">
           </div>
           <a onclick='javascript:fncSubmit();' class="btn btn-default">검색</a>
        </form>
        <ul class="nav navbar-nav navbar-right">
          <li><a id="logout" href="../auth/logout.do">로그아웃</a></li>
          <li><a id="mypage" href="myPage.html">마이페이지</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container">
    <div class="row">
      <!-- side bar -->
      <div class="col-xs-2 col-xs-2">
        <div id="side">
          <div class="row"><a href="myPage.html"><img src="../img/mypage1.png" class="title_img" /></a></div>
          <div class="side"></div>
          <div class="two row">
            <p class="pt" id="nick_view"></p>
            <div class="s_b">
              <button class="mp_b1 mp_b1--aylen" onclick="location.href='recipeControl.html'">레시피 관리</button>
              <button class="mp_b1 mp_b1--aylen" onclick="location.href='recipeRanking.html'">레시피 순위</button>
            </div>
          </div>
          <div class="two row">
            <p class="pt1" id="info">회원정보 관리</p>
            <div class="s_b">
              <button class="mp_b1 mp_b1--aylen" onclick="location.href='infoChange.html'">회원정보 변경</button>
              <button class="mp_b1 mp_b1--aylen" onclick="location.href='leave.html'">회원 탈퇴</button>
            </div>
          </div>
        </div>
      </div>    
      
      <div class="col-xs-10 col-xs-10">
        <div class="row">
          <img src="../img/change.png" class="title" style="width:210px; height: 66px;">
          <hr id="topline">
        </div>      
        <div class="col-xs-12 col-xs-12">
          <div class="row" style="margin-left:3px">
            <div class="tab_list m1">
              <ul>
                <li class="m1"><a href="#"><span>프로필 변경</span></a>
                  <ul>
                    <li style="height: 540px;">
                      <form method="post" enctype="multipart/form-data" id="fm" name="fm">
                        <div class="form-horizotal">
                          <div class="col-xs-12 data-profile" id="info_view">
                          </div>
                        </div>
                        <div class="form-group" style="text-align: right;">
                          <button type="submit" class="btn btn-primary" id="change1">변경 완료</button>
                          <button type="button" class="btn btn-default" onclick="location.href='myPage.html'">변경 취소</button>
                        </div>
                      </form>
                    </li>
                  </ul>
                </li>
              
                <li class="m2"><a href="#"><span>비밀번호 변경</span></a>
                  <ul>
                    <li style="height: 540px;">
                      <form class="form-horizontal" action="member/update1.do" Method="post">
                      <input id="Mno" type='hidden' name='no' value='{{no}}'>
                        <div class="form-group">
                          <label for="inputPassword3" class="col-xs-2 data-div">　　　기존 비밀번호</label>
                          <div class="col-xs-10">
                            <input type="password" class="form-control" id="Mpassword" name="passowrd" placeholder="Old Password">
                          </div>
                        </div>                      
                        <div class="form-group">
                          <label for="inputPassword3" class="col-xs-2 data-div">　　　새 비밀번호</label>
                          <div class="col-xs-10">
                            <input type="password" class="form-control" id="Mpassword1" name="password1" placeholder="New Password">
                          </div>
                        </div>                      
                        <div class="form-group">
                          <label for="inputPassword3" class="col-xs-2 data-div">　　　비밀번호 확인</label>
                          <div class="col-xs-10">
                            <input type="password" class="form-control" id="Mpassword2" name="password2" placeholder="New Password">
                          </div>
                        </div>                      
                        <div class="form-group">
                          <div class="col-xs-offset-2 col-xs-10">
                            <button type="button" class="btn btn-primary" id="change2">변경 완료</button>
                          </div>
                        </div>
                      </form>
                    </li>
                  </ul>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
    <hr>
    <footer>
      <div class="text-center col-xs-6 col-xs-offset-3">
        <p>Copyright &copy; 2016 &middot; All Rights Reserved &middot; <a href="http://127.0.0.1:8080/index.html">냉장고를 가져와</a></p>
      </div>
    </footer>
  </div>
  
  <script id="nick" type="text/x-handlebars-template">
    <span id="name">{{nick}}</span>'s 레시피
  </script>

  <script id="myinfo" type="text/x-handlebars-template">
    <h2>PROFILE</h2>
    <input id="Mno" type='hidden' name='no' value='{{no}}'>
    <hr>
    <img class="file-upload-image" src="{{photo}}" alt="your image" style="width:200px; height:200px;"/>
    <div class="image-title-wrap">
      <input class="file-upload-input" type='file' onchange="readURL(this);" accept="image/*" name="uploadFile" id="uploadFile"/>
    </div>
    <div class="col-xs-2 data-div">아이디</div>
    <div class="col-xs-10 data-div"><span>{{id}}</span></div>
    <div class="col-xs-2 data-div">이메일</div>
    <div class="col-xs-10 data-div"><span>{{email}}</span></div>
    <div class="col-xs-2 data-div">닉네임(5자)</div>
    <div class="col-xs-10 data-div"><input type="text" placeholder="{{nick}}"style="height: 26px" id="Mnick" name="nick"></div>
    <div class="col-xs-2 data-div">성별</div>
    <div class="col-xs-10 data-div">
      <input type="radio" name="gender" id="inlineRadio0" value="default"> 비공개
      <input type="radio" name="gender" id="inlineRadio1" value="man"> 남
      <input type="radio" name="gender" id="inlineRadio2" value="woman"> 여 
    </div>
    <div class="col-xs-2 data-div">가입일</div>
    <div class="col-xs-10 data-div"><span>{{startDate}}</span></div>
    <div class="col-xs-2 data-div">카테고리(8자)</div>
    <div class="col-xs-10 data-div"><input type="text" placeholder="{{category}}" style="height: 26px" id="Mcategory" name="category"></div>
    <div class="col-xs-2 data-div">자기소개(50자)</div>
    <div class="col-xs-10 data-div"><textarea name="description" placeholder="{{description}}" rows="3" cols="40" id="Mdescription" name="description"></textarea></div>
  </script>
  
  <script> 
    loadMember();
    function loadMember() {
      $.getJSON("../ajax/member/detail.do", function(result) {
    	  console.log(result);
    	  result.startDate = moment(result.startDate, 'MM/DD/YYYY').format().substr(0, 10);
        var template = Handlebars.compile($('#myinfo').html());
        $("#info_view").append(template(result));
        template = Handlebars.compile($('#nick').html());
        $("#nick_view").append(template(result));
        $("#Mno").val(result.no);
        // 라디오 설정
        if (result.gender == "woman") {
          $("#inlineRadio2").attr("checked", "checked");
        } else if (result.gender == "man") {
          $("#inlineRadio1").attr("checked", "checked");
        } else {
          $("#inlineRadio0").attr("checked", "checked");
        }
        
      });
    }
  </script>

  
  <script>
  $("form#fm").submit(function(event){
       //disable the default form submission
       event.preventDefault();

       var fd = new FormData($("#fm")[0]);

       $.ajax({
         url: "../ajax/member/upload.do",
         type: "POST",
         data: fd,
         async: false,
         cache: false,
         contentType: false,
         processData: false,
         success:  function(data){
        	 swal("변경 완료", "회원 정보 변경에 성공했습니다.", "success")
        	 $(".confirm").click(function() {
        		 location.href="myPage.html";
          })
         },
         error: function() {
             swal({confirmButtonColor: "#DD6B55",
                 title: "변경 실패",
                 text: "길이 제한을 확인해주십시오.",
                 type: 'warning'})
           }
       });
       return false;
   });

  </script>

  <script>
  $("#change2").click(function(event) {
    $.ajax("../ajax/member/update1.do", {
      method: "POST",
      dataType: "json",
      data: {
        no: $("#Mno").val(),
        password: $("#Mpassword").val(),
        password1: $("#Mpassword1").val(),
        password2: $("#Mpassword2").val()
      },
      success: function(result) {
    	  console.log(result);
        if (result.status == "success") {
          swal("변경 완료", "비밀번호 변경에 성공했습니다.", "success")
          $(".confirm").click(function() {
             location.href="myPage.html";
          })
        } else {
            swal({confirmButtonColor: "#DD6B55",
                title: "변경 실패",
                text: "비밀 번호을 확인해주십시오.",
                type: 'warning'})
        }
      },
      error: function() {
        console.log()
        window.alert("서버 요청 실패입니다!");
      }
    });
  });
  </script>

  <script>
    function readURL(input) {
      if (input.files && input.files[0]) {
        var reader = new FileReader();
        reader.onload = function(e) {
          $('.image-upload-wrap').hide();
          $('.file-upload-image').attr('src', e.target.result);
          $('.file-upload-content').show();
          $('.image-title').html(input.files[0].name);
        };
        reader.readAsDataURL(input.files[0]);
        console.log(input);
      } else {
        removeUpload();
      }
    }
  </script>
  <script src="../js/my_search.js"></script>
</body>
</html>